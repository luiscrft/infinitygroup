<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iиfıиıтч Gяσuρ® VTC Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --border-color: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent-primary: #38bdf8;
            --accent-secondary: #0ea5e9;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        .header {
            transition: background-color 0.3s ease-in-out, backdrop-filter 0.3s ease-in-out;
        }
        .header-scrolled {
            background-color: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
        }
        .hero-section {
             background-image: linear-gradient(to top, rgba(15, 23, 42, 1) 15%, rgba(15, 23, 42, 0.6) 60%), url('https://i.ibb.co/xKJDmL3w/Murat-Can-Tekin-500-x-500-piksel-5.png');
            background-size: cover;
            background-position: center;
        }
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.1);
        }
        .btn-primary {
            background-color: var(--accent-secondary);
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: var(--accent-primary);
        }
         .btn-outline {
            border: 1px solid var(--accent-primary);
            color: var(--accent-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
         }
         .btn-outline:hover {
             background-color: var(--accent-primary);
             color: white;
         }
        .page-content { display: none; }
        .page-content.active { display: block; animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .nav-link.active { color: var(--accent-primary); }
        .content-prose h3 {
            font-size: 1.5rem; font-weight: 700; color: var(--text-primary);
            margin-top: 2rem; margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;
        }
        .content-prose p { line-height: 1.75; margin-bottom: 1rem; color: var(--text-secondary); }
        .content-prose img { max-width: 100%; border-radius: 0.5rem; margin-top: 1rem; margin-bottom: 1rem; }
        .content-prose a { color: var(--accent-primary); text-decoration: underline; }
        .modal-overlay { transition: opacity 0.3s ease; backdrop-filter: blur(5px); }
        .modal-content { transition: transform 0.3s ease; background-color: var(--bg-secondary); border: 1px solid var(--border-color); }
        
        /* GİRİŞ FORMU İÇİN STİLLER */
        .form-input {
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            width: 100%;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-secondary);
        }
        .tab-button {
            background-color: transparent;
            border-bottom: 2px solid transparent;
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .tab-button.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
        }
        /* Şifre Göster/Gizle Butonu Stili */
        .password-toggle {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            cursor: pointer;
        }
        /* Google Butonu */
        .btn-google {
            background-color: #fff;
            color: #333;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease;
        }
        .btn-google:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>
<body class="antialiased">
    <header id="header" class="header fixed top-0 left-0 right-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#anasayfa" onclick="App.navigate('anasayfa', this)" class="flex items-center gap-3">
                <img src="https://i.ibb.co/S4sNRsSV/Murat-Can-Tekin-500-x-500-piksel-4.png" alt="Infinity Group Logo" class="h-10 w-auto">
                <span class="text-xl font-bold text-white hidden sm:block">Iиfıиıтч Gяσuρ®</span>
            </a>
            <div class="hidden md:flex items-center space-x-6 lg:space-x-8">
                <a href="#anasayfa" onclick="App.navigate('anasayfa', this)" class="nav-link text-text-secondary hover:text-white font-medium transition-colors active" data-translate="navHome">Homepage</a>
                <a href="#haberler" onclick="App.navigate('haberler', this)" class="nav-link text-text-secondary hover:text-white font-medium transition-colors" data-translate="navNews">News</a>
                <a href="#konvoylar" onclick="App.navigate('konvoylar', this)" class="nav-link text-text-secondary hover:text-white font-medium transition-colors" data-translate="navConvoys">Convoys</a>
                <a href="#ekibimiz" onclick="App.navigate('ekibimiz', this)" class="nav-link text-text-secondary hover:text-white font-medium transition-colors" data-translate="navTeam">Our Team</a>
                <a href="#galeri" onclick="App.navigate('galeri', this)" class="nav-link text-text-secondary hover:text-white font-medium transition-colors" data-translate="navGallery">Gallery</a>
                <a href="#yasal" onclick="App.navigate('yasal', this)" class="nav-link text-text-secondary hover:text-white font-medium transition-colors" data-translate="navLegal">Legal</a>
                <a href="#admin" id="admin-nav-link" style="display: none;" onclick="App.navigate('admin', this)" class="nav-link text-red-400 hover:text-red-300 font-medium transition-colors" data-translate="navAdmin">Admin</a>
            </div>
            
            <div class="hidden md:flex items-center gap-4">
                <div id="user-info" class="hidden items-center gap-4">
                    <span id="welcome-message" class="text-text-secondary text-sm"></span>
                    <button onclick="App.auth.signOut()" class="btn-outline text-white font-bold py-2 px-5 rounded-lg text-sm">
                        Logout
                    </button>
                </div>
                <div id="auth-buttons">
                    <a href="#basvuru" onclick="App.modals.open('auth')" class="btn-primary text-white font-bold py-2 px-5 rounded-lg" data-translate="applyNow">
                        Login / Sign Up
                    </a>
                </div>
            </div>
            
            <button id="mobile-menu-button" class="md:hidden text-white">
                <i class="fas fa-bars fa-2x"></i>
            </button>
        </nav>
        
        <div id="mobile-menu" class="hidden md:hidden px-6 pt-2 pb-4 space-y-3 header-scrolled">
             <a href="#anasayfa" onclick="App.navigate('anasayfa', this); closeMobileMenu()" class="nav-link block py-2 text-text-secondary hover:text-white font-medium" data-translate="navHome">Homepage</a>
             <a href="#haberler" onclick="App.navigate('haberler', this); closeMobileMenu()" class="nav-link block py-2 text-text-secondary hover:text-white font-medium" data-translate="navNews">News</a>
             <a href="#konvoylar" onclick="App.navigate('konvoylar', this); closeMobileMenu()" class="nav-link block py-2 text-text-secondary hover:text-white font-medium" data-translate="navConvoys">Convoys</a>
             <a href="#ekibimiz" onclick="App.navigate('ekibimiz', this); closeMobileMenu()" class="nav-link block py-2 text-text-secondary hover:text-white font-medium" data-translate="navTeam">Our Team</a>
             <a href="#galeri" onclick="App.navigate('galeri', this); closeMobileMenu()" class="nav-link block py-2 text-text-secondary hover:text-white font-medium" data-translate="navGallery">Gallery</a>
             <a href="#yasal" onclick="App.navigate('yasal', this); closeMobileMenu()" class="nav-link block py-2 text-text-secondary hover:text-white font-medium" data-translate="navLegal">Legal</a>
             <a href="#admin" id="admin-mobile-nav-link" style="display: none;" onclick="App.navigate('admin', this); closeMobileMenu()" class="nav-link block py-2 text-red-400 hover:text-red-300 font-medium" data-translate="navAdmin">Admin</a>
             
             <div id="user-info-mobile" class="hidden space-y-2">
                <span id="welcome-message-mobile" class="block text-center text-text-secondary text-sm"></span>
                <button onclick="App.auth.signOut(); closeMobileMenu();" class="block w-full btn-outline text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-center">
                    Logout
                </button>
             </div>
             <div id="auth-buttons-mobile">
                <a href="#basvuru" onclick="App.modals.open('auth'); closeMobileMenu();" class="block mt-2 btn-primary text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-center" data-translate="applyNow">
                    Login / Sign Up
                </a>
             </div>
        </div>
    </header>

    <main>
        
        <section id="anasayfa" class="page-content active">
            <div class="hero-section h-screen flex items-center justify-center text-center">
                <div>
                    <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-white tracking-tight leading-tight" data-translate="heroTitle">Their dream is our standard.</h1>
                    <p class="mt-4 text-lg text-text-secondary max-w-2xl mx-auto" data-translate="heroSubtitle">Join one of TruckersMP's most professional and friendly communities to take your virtual logistics experience to the next level.</p>
                    <div class="mt-8 flex justify-center gap-4">
                        <a href="#basvuru" onclick="App.navigate('basvuru', document.querySelector('a[href=\'#basvuru\']'))" class="btn-primary text-white font-bold py-3 px-8 rounded-lg text-lg" data-translate="joinUs">
                            Join Now
                        </a>
                         <a href="#konvoylar" onclick="App.navigate('konvoylar', document.querySelector('a[href=\'#konvoylar\']'))" class="btn-outline font-bold py-3 px-8 rounded-lg text-lg" data-translate="seeConvoys">
                            See Convoys
                         </a>
                    </div>
                </div>
            </div>

            <div class="container mx-auto px-6 py-24">
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="pr-0 md:pr-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-white tracking-tight" data-translate="aboutTitle">Who Are We?</h2>
                        <p class="mt-4 text-lg text-text-secondary leading-relaxed" data-translate="aboutText">
                            Iиfıиıтч Gяσuρ® was founded on 20.09.2025 and is managed professionally today. It is a Euro Truck Simulator 2 focused community, maintaining its activities regularly and steadily.
                        </p>
                    </div>
                    <div>
                        <img src="https://images.unsplash.com/photo-1616845399432-11cf71b80a27?q=80&w=2500&auto=format&fit=crop" class="rounded-xl shadow-2xl w-full" alt="Truck convoy">
                    </div>
                </div>
            </div>

            <div class="bg-bg-secondary py-24">
                <div class="container mx-auto px-6">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                        <div>
                            <p id="stats-drivers" class="text-5xl font-extrabold text-white" data-target="0">0</p>
                            <p class="mt-2 text-text-secondary font-medium" data-translate="statsDrivers">Total Drivers</p>
                        </div>
                        <div>
                            <p id="stats-convoys" class="text-5xl font-extrabold text-white" data-target="0">0</p>
                            <p class="mt-2 text-text-secondary font-medium" data-translate="statsConvoys">Upcoming Convoys</p>
                        </div>
                        <div>
                            <p id="stats-discord" class="text-5xl font-extrabold text-white" data-target="0">0</p>
                            <p class="mt-2 text-text-secondary font-medium" data-translate="statsDiscord">Discord Members</p>
                        </div>
                         <div>
                            <p class="text-5xl font-extrabold text-white">2025</p>
                            <p class="mt-2 text-text-secondary font-medium" data-translate="statsFounded">Founded</p>
                        </div>
                    </div>
                </div>
            </div>
             <div id="latest-news-homepage" class="container mx-auto px-6 py-24">
                </div>
             <section class="container mx-auto px-6 pb-24">
                <div class="bg-gradient-to-r from-sky-500 to-sky-700 rounded-xl p-8 md:p-12 text-center text-white">
                     <h2 class="text-3xl md:text-4xl font-bold tracking-tight" data-translate="ctaTitle">Ready to Join Us?</h2>
                     <p class="mt-4 text-lg text-sky-100 max-w-2xl mx-auto" data-translate="ctaSubtitle">Visit our application page to become a part of our team and share this excitement.</p>
                     <div class="mt-8">
                         <a href="#basvuru" onclick="App.navigate('basvuru', document.querySelector('a[href=\'#basvuru\']'))" class="bg-white text-sky-600 hover:bg-sky-50 font-bold py-3 px-8 rounded-lg text-lg inline-block transition-colors" data-translate="ctaButton">
                             Go to Application Page
                         </a>
                     </div>
                </div>
            </section>
        </section>

        <section id="haberler" class="page-content container mx-auto px-6 py-24 min-h-screen">
             <div class="text-center mb-16 pt-16">
                 <h2 class="text-4xl font-bold text-white tracking-tight" data-translate="newsTitle">VTC News</h2>
                 <p class="mt-4 text-lg text-text-secondary max-w-3xl mx-auto" data-translate="newsSubtitle">The latest announcements and developments from our team.</p>
             </div>
            <div id="news-list" class="space-y-8 max-w-4xl mx-auto">
                <div class="text-center text-text-secondary"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2" data-translate="loadingNews">Loading news...</p></div>
            </div>
        </section>

        <section id="konvoylar" class="page-content container mx-auto px-6 py-24 min-h-screen">
             <div class="text-center mb-16 pt-16">
                 <h2 class="text-4xl font-bold text-white tracking-tight" data-translate="convoysTitle">Upcoming Convoys</h2>
                 <p class="mt-4 text-lg text-text-secondary max-w-3xl mx-auto" data-translate="convoysSubtitle">Mark your calendars for our upcoming adventures.</p>
             </div>
            <div id="convoy-list" class="space-y-16">
                 <div class="text-center text-text-secondary"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2" data-translate="loadingConvoys">Loading convoys...</p></div>
            </div>
        </section>
        
        <section id="ekibimiz" class="page-content container mx-auto px-6 py-24 min-h-screen">
            <div class="text-center mb-16 pt-16">
                <h2 class="text-4xl font-bold text-white tracking-tight" data-translate="teamTitle">Our Team</h2>
                <p class="mt-4 text-lg text-text-secondary max-w-3xl mx-auto" data-translate="teamSubtitle">The amazing people who make up Iиfıиıтч Gяσuρ®.</p>
            </div>
            <div id="member-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                 <div class="col-span-full text-center text-text-secondary"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2" data-translate="loadingTeam">Loading team list...</p></div>
            </div>
        </section>
        
        <section id="galeri" class="page-content container mx-auto px-6 py-24 min-h-screen">
             <div class="text-center mb-16 pt-16">
                 <h2 class="text-4xl font-bold text-white tracking-tight" data-translate="galleryTitle">Our Gallery</h2>
                 <p class="mt-4 text-lg text-text-secondary max-w-3xl mx-auto" data-translate="gallerySubtitle">Some of our best moments on the road.</p>
                 <a href="https://www.instagram.com/infinity.vtc/" target="_blank" class="mt-6 btn-primary text-white font-bold py-3 px-6 rounded-lg inline-flex items-center gap-2">
                     <i class="fab fa-instagram"></i> <span data-translate="followInstagram">Follow for More</span>
                 </a>
             </div>
            <div class="columns-2 md:columns-3 gap-4 space-y-4">
                <img src="https://images.unsplash.com/photo-1544620347-c4fd4a3d_5957?q=80&w=2069&auto=format&fit=crop" class="rounded-lg shadow-lg break-inside-avoid" alt="Gallery Photo 1">
                <img src="https://images.unsplash.com/photo-1621418721094-a131a40a5f7e?q=80&w=1974&auto=format&fit=crop" class="rounded-lg shadow-lg break-inside-avoid" alt="Gallery Photo 2">
                <img src="https://images.unsplash.com/photo-1603783038319-c5f35f299052?q=80&w=2070&auto=format&fit=crop" class="rounded-lg shadow-lg break-inside-avoid" alt="Gallery Photo 3">
                <img src="https://images.unsplash.com/photo-1623281121832-3bf9e8a7f72b?q=80&w=1964&auto=format&fit=crop" class="rounded-lg shadow-lg break-inside-avoid" alt="Gallery Photo 4">
                <img src="https://images.unsplash.com/photo-1590228833939-906c5356b27d?q=80&w=1974&auto=format&fit=crop" class="rounded-lg shadow-lg break-inside-avoid" alt="Gallery Photo 5">
                <img src="https://images.unsplash.com/photo-1610414343825-961e6f733c92?q=80&w=2070&auto=format&fit=crop" class="rounded-lg shadow-lg break-inside-avoid" alt="Gallery Photo 6">
            </div>
        </section>

        <section id="basvuru" class="page-content bg-bg-secondary py-24 min-h-screen flex items-center">
            <div class="container mx-auto px-6 text-center">
                 <h2 class="text-4xl font-bold text-white tracking-tight" data-translate="applyTitle">Ready to Join Us?</h2>
                 <p class="mt-4 text-lg text-text-secondary max-w-2xl mx-auto" data-translate="applySubtitle">Login or Sign Up to become part of our community and manage your convoy slots.</p>
                 <div class="mt-8">
                     <button onclick="App.modals.open('auth')" class="btn-primary text-white font-bold py-3 px-8 rounded-lg text-lg inline-block w-auto text-center">
                        Login / Sign Up
                    </button>
                 </div>
            </div>
        </section>

        <section id="yasal" class="page-content container mx-auto px-6 py-24 min-h-screen">
            <div class="text-center mb-16 pt-16">
                 <h2 class="text-4xl font-bold text-white tracking-tight" data-translate="legalTitle">Legal Information</h2>
                 <p class="mt-4 text-lg text-text-secondary max-w-3xl mx-auto" data-translate="legalSubtitle">Our Terms of Use and Privacy Policy.</p>
            </div>
            <div class="max-w-4xl mx-auto content-prose">
                <h3 data-translate="termsTitle">Terms of Use</h3>
                <p data-translate="termsText">By using the Iиfıиıтч Gяσuρ® VTC ("we", "our") website, Discord server, and other services, you agree to these terms of use. While using our services, you are obligated to comply with TruckersMP rules and our own VTC rules. Disrespect towards the community, cheating, or harmful behavior will result in removal from the VTC. We reserve the right to terminate your membership at any time at our discretion.</p>
                
                <h3 data-translate="privacyTitle">Privacy Policy</h3>
                <p data-translate="privacyText">We value your privacy. Personal data provided during application (Discord ID, TruckersMP profile, age, etc.) is used solely for managing VTC membership, facilitating communication, and organizing community events. This information is strictly not shared with or sold to third parties. Our website may use cookies necessary for basic functionality. You have the right to request the deletion of your personal data by contacting the management.</p>

                <h3 data-translate="botPrivacyTitle">Discord Bot Privacy Policy</h3>
                <p data-translate="botPrivacyText">Our custom bot used on our Discord server may collect publicly available user information (such as User ID, username) and command usage data to provide its features and facilitate server moderation. This data is stored securely and used solely for the internal operation of the VTC. This data is never shared with third parties outside the VTC.</p>
            </div>
        </section>

         <section id="admin" class="page-content container mx-auto px-6 py-24 min-h-screen">
            <div class="text-center mb-16 pt-16">
                 <h2 class="text-4xl font-bold text-white tracking-tight" data-translate="adminTitle">Admin Panel</h2>
                 <p class="mt-4 text-lg text-text-secondary max-w-3xl mx-auto" data-translate="adminSubtitle">Convoy Slot Management</p>
            </div>
            <div id="admin-convoy-list" class="space-y-8 max-w-4xl mx-auto">
                 <div class="text-center text-text-secondary"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2" data-translate="loadingAdminConvoys">Loading convoys to manage...</p></div>
            </div>
        </section>
    </main>

    <footer class="border-t border-border-color mt-24">
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="col-span-1 md:col-span-2">
                    <div class="flex items-center gap-3 mb-4">
                        <img src="https://i.ibb.co/S4sNRsSV/Murat-Can-Tekin-500-x-500-piksel-4.png" alt="Infinity Group Logo" class="h-10 w-auto">
                        <span class="text-xl font-bold text-white">Iиfıиıтч Gяσuρ®</span>
                    </div>
                    <p class="text-text-secondary max-w-md" data-translate="footerSlogan">"Their dream is our standard."</p>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-4" data-translate="footerSitemap">Sitemap</h4>
                    <ul class="space-y-2">
                        <li><a href="#anasayfa" onclick="App.navigate('anasayfa', this)" class="text-text-secondary hover:text-white" data-translate="navHome">Homepage</a></li>
                        <li><a href="#haberler" onclick="App.navigate('haberler', this)" class="text-text-secondary hover:text-white" data-translate="navNews">News</a></li>
                        <li><a href="#konvoylar" onclick="App.navigate('konvoylar', this)" class="text-text-secondary hover:text-white" data-translate="navConvoys">Convoys</a></li>
                        <li><a href="#ekibimiz" onclick="App.navigate('ekibimiz', this)" class="text-text-secondary hover:text-white" data-translate="navTeam">Our Team</a></li>
                        <li><a href="#yasal" onclick="App.navigate('yasal', this)" class="text-text-secondary hover:text-white" data-translate="navLegal">Legal</a></li>
                         <li id="admin-footer-link" style="display: none;"><a href="#admin" onclick="App.navigate('admin', this)" class="text-red-400 hover:text-red-300" data-translate="navAdmin">Admin</a></li>
                    </ul>
                </div>
                 <div>
                    <h4 class="text-white font-bold mb-4" data-translate="footerSocial">Social Media</h4>
                    <ul class="space-y-2">
                        <li><a href="https://truckersmp.com/vtc/83171" target="_blank" class="text-text-secondary hover:text-white">TruckersMP</a></li>
                        <li><a href="https://discord.gg/infinitygroup" target="_blank" class="text-text-secondary hover:text-white">Discord</a></li>
                    </ul>
                </div>
            </div>
            <div class="mt-8 border-t border-border-color pt-6 text-center text-text-secondary">
                <p>&copy; 2025 Iиfıиıтч Gяσuρ® VTC. <span data-translate="footerRights">All rights reserved.</span></p>
            </div>
        </div>
    </footer>

    <div id="modal-container"></div> <div id="auth-modal-container"></div> <script>
        // ========================================================
        // SUPABASE BAĞLANTISI
        // ========================================================
        
        const SUPABASE_URL = 'https://dtewqstchueaehpogqvr.supabase.co'; // Örn: https://xxxx.supabase.co
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0ZXdxc3RjaHVlYWVocG9ncXZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MzU0MzcsImV4cCI6MjA3NzUxMTQzN30.9YnfQ8jHafKlWu5C307MqDW2ZpR_xOIEZTg3NyRVGD0'; // Örn: eyJh...
        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        console.log('Supabase Connection Initialized:', _supabase ? 'Success' : 'Failed');
        // ========================================================
        
        
        const App = {
            state: {
                bookedSlots: JSON.parse(localStorage.getItem('bookedSlots')) || {},
                isAdmin: false, 
                currentUser: null, 
                liveConvoys: [],
                liveMembers: { members: [] },
                liveNews: { news: [] },
                liveVtcInfo: null
            },
            fallbackData: {
                convoys: [
                    { id: 1, name: 'Fallback: Weekly Official Convoy', start_at: '2099-10-25T18:00:00Z', banner: 'https://placehold.co/1200x400/1e293b/E6EDF3?text=Convoy+Banner', departure: {city: 'Berlin', name: 'LKW'}, arrive: {city: 'Amsterdam', name: 'Stokes'}, server: {name: 'Simulation 1'}, vtc: {id: 83171}, slots_total: 20 },
                    { id: 2, name: 'Fallback: Partner Convoy', start_at: '2099-11-01T18:30:00Z', banner: 'https://placehold.co/1200x400/1e293b/E6EDF3?text=Convoy+Banner', departure: {city: 'Oslo', name: 'Polaris Lines'}, arrive: {city: 'Stockholm', name: 'Vitas Power'}, server: {name: 'Simulation 2'}, vtc: {id: 83171}, slots_total: 4 },
                ],
                members: {
                    members: [
                        { user_id: 5437763, username: 'Lichna', role: 'Owner', roles: [{ order: 0 }] },
                        { user_id: 5848363, username: 'lastshot733', role: 'Owner', roles: [{ order: 0 }] },
                        { user_id: 5517778, username: 'Kalastre', role: 'Co-Founder', roles: [{ order: 1 }] },
                        { user_id: 5099262, username: 'twReasy', role: 'Head Admin', roles: [{ order: 2 }] },
                        { user_id: 5517888, username: 'sweaq', role: 'Admin', roles: [{ order: 3 }] },
                        { user_id: 5854720, username: '[SPLV] - musti4747', role: 'Admin', roles: [{ order: 3 }] },
                        { user_id: 1956922, username: 'NicksizGame', role: 'Mod', roles: [{ order: 5 }] },
                        { user_id: 5710298, username: 'barankocatepe', role: 'Registration Manager', roles: [{ order: 6 }] },
                        { user_id: 4044981, username: 'G-O-N-Y-A-L-I', role: 'Driver', roles: [{ order: 8 }] },
                        { user_id: 5283947, username: 'bandırmalıqt1', role: 'Driver', roles: [{ order: 8 }] },
                    ]
                },
                vtc: { members_count: 10 },
                discord: { approximate_member_count: 150 },
                 news: {
                    news: [
                        {id: 1, title: "Our New Website is Live!", author: {username: "Management"}, published_at: "2025-10-20T10:00:00Z", content: "<p>Our VTC's new website is now live! We are here with a more modern and functional interface.</p>"},
                        {id: 2, title: "October Convoy Schedule", author: {username: "Event Team"}, published_at: "2025-10-15T14:30:00Z", content: "<p>The list of convoys we will organize throughout October has been updated on our Convoys page.</p>"}
                    ]
                 }
            },
            
            async apiFetch(url) {
                try {
                    const proxyUrl = `https://api.codetabs.com/v1/proxy/?quest=`;
                    const response = await fetch(proxyUrl + url, {
                        headers: { 'User-Agent': 'twReasy/InfinityGroup-Website-V22' } 
                    });
                    if (!response.ok) throw new Error(`API request failed: ${response.status}`);
                    const data = await response.json();
                    if (data.error === true || (typeof data.error === 'string' && data.error !== "false")) {
                         if (data.response && data.response.includes("rate limit")) console.warn(`Rate limit hit for ${url}`);
                         throw new Error(`API error: ${data.response || 'Unknown error'}`);
                    }
                    return data;
                } catch (error) {
                    console.error(`Error fetching API data (${url}):`, error);
                    return null;
                }
            },

            fetchAndRenderAllData() {
                 console.log("Fetching new data...");
                Promise.all([
                    this.apiFetch('https://api.truckersmp.com/v2/vtc/83171'), 
                    this.apiFetch('https://api.truckersmp.com/v2/vtc/83171/events'),
                    this.apiFetch('https://api.truckersmp.com/v2/vtc/83171/events/attending'),
                    this.apiFetch('https://discord.com/api/v9/invites/infinitygroup?with_counts=true'),
                    this.apiFetch('https://api.truckersmp.com/v2/vtc/83171/members'), 
                    this.apiFetch('https://api.truckersmp.com/v2/vtc/83171/news')
                ]).then(([vtcData, ownEventsData, attendingEventsData, discordData, membersData, newsData]) => {
                     console.log("Data fetched:", { vtcData, membersData });

                    this.state.liveVtcInfo = vtcData ? vtcData.response : null;
                    const ownEvents = ownEventsData ? ownEventsData.response : null;
                    const attendingEvents = attendingEventsData ? attendingEventsData.response : null;
                    this.state.liveMembers = membersData ? membersData.response : null;
                    this.state.liveNews = newsData ? newsData.response : null;

                    const stats = {
                        drivers: this.state.liveVtcInfo ? this.state.liveVtcInfo.members_count : this.fallbackData.vtc.members_count,
                        discord: discordData ? discordData.approximate_member_count : this.fallbackData.discord.approximate_member_count
                    };
                    
                    const combinedEvents = [...(ownEvents || []), ...(attendingEvents || [])];
                    const uniqueEventsMap = new Map();
                    if (Array.isArray(combinedEvents)) {
                        for (const event of combinedEvents) {
                            if (event && event.id) {
                                uniqueEventsMap.set(event.id, event);
                            }
                        }
                    }
                    const allEvents = Array.from(uniqueEventsMap.values());
                    
                    this.state.liveConvoys = allEvents;
                    const futureEvents = allEvents.filter(event => event && event.start_at && new Date(event.start_at) > new Date());
                    stats.convoys = futureEvents.length;

                    this.renderStats(stats);
                    
                    const convoysToRender = (ownEvents || attendingEvents) ? this.state.liveConvoys : this.fallbackData.convoys;
                    this.renderConvoys(convoysToRender, !ownEvents && !attendingEvents);

                    this.renderMembers(
                        this.state.liveMembers || this.fallbackData.members, 
                        !this.state.liveMembers
                    );
                    
                    this.renderNews(this.state.liveNews ? this.state.liveNews.news : this.fallbackData.news.news, !this.state.liveNews);

                    if(this.state.isAdmin) {
                         this.renderAdminPanelConvoys(allEvents.length > 0 ? allEvents : this.fallbackData.convoys);
                    }
                    
                    this.setupScrollAnimations(true);
                    this.language.apply(); 
                });
            },

             init() {
                 this.language.apply(); 
                 this.fetchAndRenderAllData();
                 setInterval(() => this.fetchAndRenderAllData(), 300000);
                 
                 this.auth.init(); // Sayfa yüklendiğinde giriş yapan kullanıcı var mı diye kontrol et

                 const header = document.getElementById('header');
                 window.addEventListener('scroll', () => header.classList.toggle('header-scrolled', window.scrollY > 50));
                 const mobileMenuButton = document.getElementById('mobile-menu-button');
                 const mobileMenu = document.getElementById('mobile-menu');
                 mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
                 window.closeMobileMenu = () => mobileMenu.classList.add('hidden');

                 this.setupScrollAnimations();
             },
            
            navigate(pageId, element) {
                 document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
                 const targetPage = document.getElementById(pageId);
                 if (targetPage) targetPage.classList.add('active');
                
                 document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                 if (element && element.classList) {
                     element.classList.add('active');
                 } else {
                     document.querySelectorAll(`a[href="#${pageId}"]`).forEach(l => l.classList.add('active'));
                 }

                 window.scrollTo({ top: 0, behavior: 'instant' });
                 if (window.innerWidth < 768) closeMobileMenu();
            },

            renderStats(stats) {
                 const driversEl = document.getElementById('stats-drivers');
                 const convoysEl = document.getElementById('stats-convoys');
                 const discordEl = document.getElementById('stats-discord');

                 if (driversEl) driversEl.dataset.target = stats.drivers;
                 if (convoysEl) convoysEl.dataset.target = stats.convoys;
                 if (discordEl) discordEl.dataset.target = stats.discord;

                 if (driversEl) driversEl.removeAttribute('data-animated');
                 if (convoysEl) convoysEl.removeAttribute('data-animated');
                 if (discordEl) discordEl.removeAttribute('data-animated');
            },

            renderConvoys(data, isFallback = false) {
                 const container = document.getElementById('convoy-list');
                 if (!container) return;

                 let html = '';
                 if (isFallback) {
                     html = `<div class="col-span-full text-center text-yellow-500 bg-yellow-500/10 py-2 rounded-lg text-sm mb-8" data-translate="convoyFallback"></div>`;
                 }

                 if (!data || data.length === 0) {
                     container.innerHTML = html + `<div class="text-center text-text-secondary"><p data-translate="noConvoys"></p></div>`;
                     this.language.apply();
                     return;
                 }
                
                 const futureEvents = data.filter(event => event && event.start_at && new Date(event.start_at) > new Date());
                 if (futureEvents.length === 0) {
                     container.innerHTML = html + `<div class="text-center text-text-secondary"><p data-translate="noConvoys"></p></div>`;
                     this.language.apply();
                     return;
                 }

                 const ourVtcId = 83171;
                 const ourConvoys = futureEvents.filter(event => event.vtc && event.vtc.id === ourVtcId).sort((a, b) => new Date(a.start_at) - new Date(b.start_at));
                 const attendingConvoys = futureEvents.filter(event => event.vtc && event.vtc.id !== ourVtcId).sort((a, b) => new Date(a.start_at) - new Date(b.start_at));

                 const createCardHtml = (event, isOurConvoy) => {
                     if (!event || !event.start_at) return '';
                      const dateStr = event.start_at.endsWith('Z') ? event.start_at : event.start_at.replace(' ', 'T') + 'Z';
                     const date = new Date(dateStr);
                     const formattedDate = date.toLocaleString('en-US', { day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', timeZone: 'Europe/Istanbul' });
                     
                     return `
                     <div class="card rounded-xl overflow-hidden flex flex-col md:flex-row">
                         <img src="${event.banner}" alt="${event.name}" class="w-full md:w-1/3 h-48 md:h-auto object-cover" onerror="this.src='https://placehold.co/400x200/1e293b/94a3b8?text=No+Banner';">
                         <div class="p-6 flex flex-col flex-grow">
                             <h3 class="text-xl font-bold text-white">${event.name}</h3>
                             ${event.vtc ? `<p class="text-sm text-sky-300 mt-1"><span data-translate="hostedBy"></span> ${event.vtc.name}</p>` : ''}
                             <p class="text-accent-secondary font-semibold mt-1">${formattedDate} (TSI)</p>
                             <div class="mt-4 border-t border-border-color pt-4 space-y-2 text-text-secondary">
                                 <p><i class="fas fa-map-marker-alt fa-fw w-5"></i> <span data-translate="departure"></span> ${event.departure?.city || '?'} (${event.departure?.name || '?'})</p>
                                 <p><i class="fas fa-flag-checkered fa-fw w-5"></i> <span data-translate="arrival"></span> ${event.arrive?.city || '?'} (${event.arrive?.name || '?'})</p>
                                 <p><i class="fas fa-server fa-fw w-5"></i> <span data-translate="server"></span> ${event.server?.name || '?'}</p>
                             </div>
                             ${isOurConvoy ? `
                             <div class="mt-auto pt-4">
                                 <button onclick="App.modals.open('slot', ${event.id})" class="btn-outline w-full md:w-auto px-4 py-2 rounded-lg text-sm" data-translate="selectSlot">
                                 </button>
                             </div>
                             ` : ''}
                         </div>
                     </div>`;
                 };

                 let contentHtml = '';
                 if (ourConvoys.length > 0) {
                     contentHtml += `<div class="space-y-8"><h3 class="text-2xl font-bold text-white tracking-tight" data-translate="ourConvoys"></h3>${ourConvoys.map(e => createCardHtml(e, true)).join('')}</div>`;
                 }
                 if (attendingConvoys.length > 0) {
                     contentHtml += `<div class="space-y-8 mt-16"><h3 class="text-2xl font-bold text-white tracking-tight" data-translate="attendingConvoys"></h3>${attendingConvoys.map(e => createCardHtml(e, false)).join('')}</div>`;
                 }
                 container.innerHTML = html + contentHtml;
                 this.language.apply();
            },

            renderMembers(data, isFallback = false) {
                 const container = document.getElementById('member-list');
                 if (!container) return;
                
                 let html = '';
                 if (isFallback) html += `<div class="col-span-full text-center text-yellow-500 bg-yellow-500/10 py-2 rounded-lg text-sm mb-4" data-translate="teamFallback"></div>`;

                 if (!data || !data.members || data.members.length === 0) {
                      html += `<p class="col-span-full text-center text-text-secondary" data-translate="noMembers"></p>`;
                       container.innerHTML = html;
                       this.language.apply();
                     return;
                 }

                 const members = data.members;

                 const sortedMembers = members.sort((a, b) => {
                     const orderA = a.roles && a.roles[0] ? a.roles[0].order : 99;
                     const orderB = b.roles && b.roles[0] ? b.roles[0].order : 99;
                     
                     if (orderA !== orderB) {
                         return orderA - orderB;
                     }
                     return a.username.localeCompare(b.username);
                 });
                
                  html += sortedMembers.map(member => {
                      const displayRole = member.role;
                      
                      return `
                         <a href="https://truckersmp.com/user/${member.user_id}" target="_blank" class="card rounded-xl p-6 text-center flex flex-col group">
                             <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(member.username)}&background=161B22&color=E6EDF3&bold=true&size=128" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-border-color">
                             <h4 class="text-lg font-bold text-white truncate">${member.username}</h4>
                             <p class="text-accent-secondary font-semibold">${displayRole}</p> 
                             <span class="mt-auto pt-4 text-sm text-text-secondary group-hover:text-white transition-colors" data-translate="viewProfile"> <i class="fas fa-external-link-alt ml-1"></i></span>
                         </a>
                     `
                 }).join('');
                 container.innerHTML = html;
                 this.language.apply();
            },

            renderNews(newsData, isFallback = false) {
                 const newsListContainer = document.getElementById('news-list');
                 const latestNewsContainer = document.getElementById('latest-news-homepage');

                 let fallbackHtmlNews = '';
                 let fallbackHtmlLatest = '';
                 if (isFallback) {
                      fallbackHtmlNews = `<div class="text-center text-yellow-500 bg-yellow-500/10 py-2 rounded-lg text-sm mb-4" data-translate="newsFallback"></div>`;
                      fallbackHtmlLatest = fallbackHtmlNews;
                 }

                 if (!newsData || newsData.length === 0) {
                      if (latestNewsContainer) latestNewsContainer.style.display = 'none';
                      if (newsListContainer) newsListContainer.innerHTML = fallbackHtmlNews + `<p class="text-center text-text-secondary" data-translate="noNews"></p>`;
                      this.language.apply();
                     return;
                 }

                 if (newsListContainer) {
                     newsListContainer.innerHTML = fallbackHtmlNews + newsData.map(post => {
                         const date = new Date(post.published_at);
                         const formattedDate = date.toLocaleString('en-US', { day: '2-digit', month: 'long', year: 'numeric' });
                         return `
                         <div class="card rounded-xl p-8 content-prose">
                             <h3 class="mt-0">${post.title}</h3>
                             <p class="text-sm text-text-secondary mt-1"><span data-translate="publishedBy"></span> ${post.author.username} - ${formattedDate}</p>
                             <div class="mt-4 border-t border-border-color pt-4">${post.content}</div>
                         </div>
                         `
                     }).join('');
                 }

                 if (latestNewsContainer) {
                     const latestPosts = newsData.slice(0, 2);
                     latestNewsContainer.style.display = 'block';
                     latestNewsContainer.innerHTML = `
                     <div class="text-center mb-16">
                         <h2 class="text-3xl md:text-4xl font-bold text-white tracking-tight" data-translate="latestNewsTitle"></h2>
                         <p class="mt-4 text-lg text-text-secondary max-w-3xl mx-auto" data-translate="latestNewsSubtitle"></p>
                         ${fallbackHtmlLatest}
                     </div>
                     <div class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                         ${latestPosts.map(post => {
                             const date = new Date(post.published_at);
                             const formattedDate = date.toLocaleString('en-US', { day: '2-digit', month: 'long', year: 'numeric' });
                              const summary = post.content.replace(/<[^>]*>?/gm, '').substring(0, 150) + '...';
                             return `
                             <div class="card rounded-xl p-6">
                                 <h3 class="text-xl font-bold text-white truncate">${post.title}</h3>
                                 <p class="text-sm text-text-secondary mt-1">${formattedDate}</p>
                                 <p class="mt-4 text-text-secondary text-sm">${summary}</p>
                                 <a href="#haberler" onclick="App.navigate('haberler', document.querySelector('a[href=\\'#haberler\\']'))" class="text-accent-secondary font-semibold mt-4 inline-block" data-translate="readMore"> <i class="fas fa-arrow-right ml-1"></i></a>
                             </div>
                             `
                         }).join('')}
                     </div>
                     `;
                 }
                 this.language.apply();
            },
            
            renderAdminPanelConvoys(data) {
                 const container = document.getElementById('admin-convoy-list');
                 if (!container || !this.state.isAdmin) {
                    if(container) container.innerHTML = ''; 
                    return;
                 }

                 let html = '';
                  if (!data || data.length === 0) {
                      html = `<p class="text-center text-text-secondary" data-translate="noAdminConvoys"></p>`;
                     container.innerHTML = html;
                     this.language.apply();
                     return;
                 }

                 const ourVtcId = 83171;
                 const ourConvoys = data.filter(event => event && event.vtc && event.vtc.id === ourVtcId && event.start_at && new Date(event.start_at) > new Date())
                                         .sort((a, b) => new Date(a.start_at) - new Date(b.start_at));

                 if (ourConvoys.length === 0) {
                     html = `<p class="text-center text-text-secondary" data-translate="noAdminConvoys"></p>`;
                     container.innerHTML = html;
                     this.language.apply();
                     return;
                 }

                  html = ourConvoys.map(event => {
                      const date = new Date(event.start_at.endsWith('Z') ? event.start_at : event.start_at.replace(' ', 'T') + 'Z');
                      const formattedDate = date.toLocaleString('en-US', { day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', timeZone: 'Europe/Istanbul' });
                      
                      const eventDataString = encodeURIComponent(JSON.stringify(event));

                      return `
                         <div class="card rounded-xl p-6 flex flex-col md:flex-row items-center gap-4">
                             <img src="${event.banner}" alt="${event.name}" class="w-full md:w-1/4 h-24 object-cover rounded-lg mb-4 md:mb-0" onerror="this.src='https://placehold.co/400x200/1e293b/94a3b8?text=No+Banner';">
                             <div class="flex-grow text-center md:text-left">
                                 <h3 class="text-lg font-bold text-white">${event.name}</h3>
                                 <p class="text-accent-secondary text-sm">${formattedDate} (TSI)</p>
                                 <p class="text-xs text-text-secondary mt-1">TMP ID: ${event.id}</p>
                             </div>
                             <button onclick="App.modals.open('manage_convoy', '${eventDataString}')" class="btn-primary w-full md:w-auto px-4 py-2 rounded-lg text-sm" data-translate="manageSlots">
                                 Manage Slots
                             </button>
                         </div>
                         `;
                  }).join('');
                  container.innerHTML = html;
                  this.language.apply();
            },

            modals: {
                 open(type, data = null) {
                     let container, content, modalMaxWidth;
                     
                     if (type === 'slot') {
                         container = document.getElementById('modal-container');
                         modalMaxWidth = 'max-w-4xl';
                         
                         // BU ESKİ SİSTEM ARTIK DEVRE DIŞI.
                         content = `
                            <div class="flex justify-between items-start mb-6">
                                <h2 class="text-3xl font-bold text-white">Slot Selection</h2>
                                <button onclick="App.modals.close('slot')" class="text-gray-400 text-3xl leading-none hover:text-white">&times;</button>
                            </div>
                            <p class="text-text-secondary">This feature is being upgraded. Please login as a VTC Leader to book a slot for your VTC.</p>
                         `;
                     } 
                     
                     else if (type === 'auth') {
                         container = document.getElementById('auth-modal-container');
                         modalMaxWidth = 'max-w-lg'; 
                         content = `
                            <div class="flex justify-between items-start mb-6">
                                <h2 class="text-3xl font-bold text-white">VTC Portal Access</h2>
                                <button onclick="App.modals.close('auth')" class="text-gray-400 text-3xl leading-none hover:text-white">&times;</button>
                            </div>
                            
                            <div id="auth-error" class="p-3 rounded-lg mb-4" style="display: none;"></div>
                            
                            <button onclick="App.auth.signInWithGoogle()" class="btn-google w-full py-3 rounded-lg font-bold flex items-center justify-center gap-2">
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 48 48"><g><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g></svg>
                                Sign in with Google
                            </button>
                            
                            <div class="my-4 flex items-center">
                                <div class="flex-grow border-t border-border-color"></div>
                                <span class="mx-4 text-text-secondary">OR</span>
                                <div class="flex-grow border-t border-border-color"></div>
                            </div>

                            <div class="border-b border-border-color mb-6">
                                <button id="tab-login" class="tab-button active" onclick="App.auth.showTab('login')">Login</button>
                                <button id="tab-signup" class="tab-button" onclick="App.auth.showTab('signup')">Sign Up (VTC Leaders)</button>
                            </div>
                            
                            <form id="login-form" class="space-y-4" onsubmit="App.auth.signIn(event)">
                                <div>
                                    <label for="login-email" class="block text-sm font-medium text-text-secondary mb-1">Email</label>
                                    <input type="email" id="login-email" class="form-input" required>
                                </div>
                                <div>
                                    <label for="login-password" class="block text-sm font-medium text-text-secondary mb-1">Password</label>
                                    <div class="relative">
                                        <input type="password" id="login-password" class="form-input" required>
                                        <i class="fas fa-eye password-toggle" onclick="App.auth.togglePasswordVisibility('login-password', this)"></i>
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary w-full py-3 rounded-lg font-bold">Login</button>
                            </form>
                            
                            <form id="signup-form" class="space-y-4" style="display: none;" onsubmit="App.auth.signUp(event)">
                                <div>
                                    <label for="signup-username" class="block text-sm font-medium text-text-secondary mb-1">Username (Your Name)</label>
                                    <input type="text" id="signup-username" class="form-input" required>
                                </div>
                                <div>
                                    <label for="signup-vtc" class="block text-sm font-medium text-text-secondary mb-1">VTC Name (Your VTC)</label>
                                    <input type="text" id="signup-vtc" class="form-input" required>
                                </div>
                                <div>
                                    <label for="signup-email" class="block text-sm font-medium text-text-secondary mb-1">Email</label>
                                    <input type="email" id="signup-email" class="form-input" required>
                                </div>
                                <div>
                                    <label for="signup-password" class="block text-sm font-medium text-text-secondary mb-1">Password</label>
                                     <div class="relative">
                                        <input type="password" id="signup-password" class="form-input" minlength="6" required>
                                        <i class="fas fa-eye password-toggle" onclick="App.auth.togglePasswordVisibility('signup-password', this)"></i>
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary w-full py-3 rounded-lg font-bold">Create Account</button>
                            </form>
                         `;
                     }
                     
                     else if (type === 'manage_convoy') {
                        container = document.getElementById('modal-container'); 
                        modalMaxWidth = 'max-w-4xl';
                        
                        const event = JSON.parse(decodeURIComponent(data));
                        
                        content = `
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h2 class="text-3xl font-bold text-white">Manage Slots: ${event.name}</h2>
                                    <p class="text-text-secondary">TMP ID: ${event.id}</p>
                                </div>
                                <button onclick="App.modals.close('slot')" class="text-gray-400 text-3xl leading-none hover:text-white">&times;</button>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="card p-6">
                                    <h3 class="text-xl font-bold text-white mb-4">Slot Map Image</h3>
                                    <p class="text-sm text-text-secondary mb-4">Upload a parking map image (PNG/JPG). This map will be shown to VTC leaders.</p>
                                    <input type="file" id="slot-map-upload" class="form-input" accept="image/png, image/jpeg">
                                    <button class="btn-primary w-full py-2 rounded-lg font-bold mt-4">Upload Image</button>
                                </div>
                                
                                <div class="card p-6">
                                    <h3 class="text-xl font-bold text-white mb-4">Manage Zones</h3>
                                    <p class="text-sm text-text-secondary mb-4">Add parking zones and set their VTC capacity.</p>
                                    <form class="flex gap-2">
                                        <input type="text" id="zone-name" placeholder="Zone Name (e.g., Main Lot)" class="form-input w-2/3">
                                        <input type="number" id="zone-capacity" placeholder="Cap." class="form-input w-1/3" min="1" value="10">
                                        <button type="submit" class="btn-primary px-4 rounded-lg font-bold">Add</button>
                                    </form>
                                    
                                    <div id="zone-list" class="mt-4 space-y-2">
                                        <p class="text-text-secondary text-sm">No zones added yet.</p>
                                    </div>
                                </div>
                            </div>
                        `;
                     }
                     
                     
                     if (container && content) {
                         const modalIdType = (type === 'manage_convoy' || type === 'slot') ? 'slot' : 'auth';
                         
                         container.innerHTML = `
                             <div id="modal-overlay-${modalIdType}" class="modal-overlay fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-[999] fade-in" onclick="App.modals.close('${modalIdType}')">
                                 <div class="modal-content w-full ${modalMaxWidth} rounded-xl shadow-lg p-8 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                                     ${content}
                                 </div>
                             </div>
                         `;
                         App.language.apply();
                     }
                 },
                 close(type = 'slot') {
                     const overlay = document.getElementById(`modal-overlay-${type}`);
                     if (overlay) {
                         overlay.style.opacity = 0;
                         setTimeout(() => overlay.remove(), 300);
                     }
                 }
            },

            slots: {
                 select(convoyId, slotId) {
                     alert('This booking system is being upgraded! Please login as a VTC Leader.');
                 }
            },
            
             getAllEventsData() {
                 const data = App.state.liveConvoys.length > 0 ? App.state.liveConvoys : App.fallbackData.convoys;
                 return data.filter(c => c && c.vtc?.id === 83171);
             },
            
            // ========================================================
            // !!! TAMAMEN GÜNCELLENMİŞ AUTH BÖLÜMÜ !!!
            // ========================================================
            auth: {
                init() {
                    _supabase.auth.onAuthStateChange(async (event, session) => {
                        console.log('Auth State Change:', event);
                        if (session && session.user && (event === 'INITIAL_SESSION' || event === 'SIGNED_IN' || event === 'USER_UPDATED')) {
                            // Kullanıcı giriş yapmış veya oturumu devam ediyor, profilini çek veya oluştur
                            await this.getProfile(session.user);
                        } else if (event === 'SIGNED_OUT') {
                            App.state.currentUser = null;
                            App.state.isAdmin = false;
                        }
                        this.updateUI();
                    });
                },
                
                async getProfile(user) {
                    try {
                        let { data: profile, error } = await _supabase
                            .from('profiles')
                            .select('username, vtc_name, role')
                            .eq('id', user.id)
                            .single();
                            
                        if (error && error.code === 'PGRST116') {
                            // Hata Kodu PGRST116 = "0 satır döndü" (Yani profil yok)
                            console.warn("No profile found for user, creating one...");
                            
                            // Google ile giriş yapanlar için varsayılan profil oluştur
                            const { data: newProfile, error: insertError } = await _supabase
                                .from('profiles')
                                .insert({
                                    id: user.id,
                                    // Google adı varsa kullan, yoksa e-postanın başını kullan
                                    username: user.user_metadata?.full_name || user.email.split('@')[0],
                                    vtc_name: 'N/A' // Google kullanıcısının VTC'si bilinmiyor
                                })
                                .select()
                                .single();
                                
                            if(insertError) {
                                console.error("Error creating profile:", insertError.message);
                                App.state.currentUser = user; // Profilsiz devam et
                            } else {
                                App.state.currentUser = { ...user, ...newProfile };
                                App.state.isAdmin = (newProfile.role === 'admin');
                            }
                            
                        } else if (profile) {
                            // Profil bulundu, state'i ayarla
                            App.state.currentUser = { ...user, ...profile };
                            App.state.isAdmin = (profile.role === 'admin');
                        } else {
                            // Başka bir hata
                            console.error('Error fetching profile:', error.message);
                            App.state.currentUser = user; 
                        }
                    } catch (e) {
                        console.error("Error in getProfile:", e);
                    }
                    
                    console.log('Current User Profile:', App.state.currentUser);
                    this.updateUI(); // Profil çekildikten sonra UI'ı son kez güncelle
                },
                
                // ========================================================
                // !!! GÜNCELLENMİŞ KAYIT (SIGN UP) FONKSİYONU !!!
                // (Artık SQL Trigger'ına güvenmiyor)
                // ========================================================
                async signUp(event) {
                    event.preventDefault();
                    const username = document.getElementById('signup-username').value;
                    const vtc_name = document.getElementById('signup-vtc').value;
                    const email = document.getElementById('signup-email').value;
                    const password = document.getElementById('signup-password').value;
                    const errorEl = document.getElementById('auth-error');
                    errorEl.style.display = 'none';

                    // 1. ADIM: Kullanıcıyı Auth'a kaydet
                    const { data: authData, error: authError } = await _supabase.auth.signUp({
                        email: email,
                        password: password
                    });

                    if (authError) {
                        errorEl.textContent = `Sign Up Error: ${authError.message}`;
                        errorEl.style.display = 'block';
                        return;
                    }
                    
                    if (!authData.user) {
                        errorEl.textContent = "Sign up successful, but user data not returned. Please try logging in.";
                        errorEl.style.display = 'block';
                        return;
                    }
                    
                    console.log("User created in Auth, now creating profile...");

                    // 2. ADIM: MANUEL OLARAK 'profiles' tablosuna ekle
                    const { error: profileError } = await _supabase
                        .from('profiles')
                        .insert({
                            id: authData.user.id, // Auth ID'sini kopyala
                            username: username,
                            vtc_name: vtc_name,
                            role: 'vtc_leader' // Varsayılan rol
                        });
                    
                    if (profileError) {
                        errorEl.textContent = `Sign Up Error (Profile): ${profileError.message}. Please contact an admin.`;
                        errorEl.style.display = 'block';
                        return;
                    }

                    // 3. ADIM: Başarılı, şimdi otomatik giriş yap
                    console.log("Profile created. Logging in...");
                    errorEl.textContent = "Sign up successful! Logging you in...";
                    errorEl.style.display = "block";
                    errorEl.classList.remove('text-red-400', 'bg-red-500/10');
                    errorEl.classList.add('text-green-400', 'bg-green-500/10');
                    
                    await this.signIn(null, email, password);
                },
                
                // ========================================================
                // !!! GÜNCELLENMİŞ GİRİŞ (SIGN IN) FONKSİYONU !!!
                // ========================================================
                async signIn(event, emailOverride = null, passwordOverride = null) {
                    if (event) event.preventDefault();
                    
                    const email = emailOverride || document.getElementById('login-email').value;
                    const password = passwordOverride || document.getElementById('login-password').value;
                    const errorEl = document.getElementById('auth-error');
                    errorEl.style.display = 'none';

                    // 1. Giriş yapmayı dene
                    const { data, error } = await _supabase.auth.signInWithPassword({
                        email: email,
                        password: password,
                    });

                    if (error) {
                        // Hata varsa göster
                        errorEl.textContent = `Login Error: ${error.message}`;
                        errorEl.style.display = 'block';
                    } else if (data.user) {
                        // BAŞARILI!
                        // 2. Kullanıcı bilgilerini ve profili ANINDA çek
                        await this.getProfile(data.user);
                        
                        // 3. Arayüzü anında güncelle
                        this.updateUI();
                        
                        // 4. Modalı kapat
                        App.modals.close('auth');
                    }
                },
                
                // ========================================================
                // !!! YENİ FONKSİYON: Google ile Giriş !!!
                // ========================================================
                async signInWithGoogle() {
                    const { error } = await _supabase.auth.signInWithOAuth({
                        provider: 'google'
                    });
                    if (error) {
                        const errorEl = document.getElementById('auth-error');
                        errorEl.textContent = `Google Login Error: ${error.message}`;
                        errorEl.style.display = 'block';
                    }
                },
                
                async signOut() {
                    const { error } = await _supabase.auth.signOut();
                    if(error) {
                        console.error("Sign out error:", error);
                    } else {
                        // State'i anında temizle ve UI'ı güncelle
                        App.state.currentUser = null;
                        App.state.isAdmin = false;
                        this.updateUI();
                        App.navigate('anasayfa', document.querySelector('a[href="#anasayfa"]'));
                    }
                },
                
                updateUI() {
                    const user = App.state.currentUser;
                    const isAdmin = App.state.isAdmin;
                    
                    const userInfo = document.getElementById('user-info');
                    const authButtons = document.getElementById('auth-buttons');
                    const welcomeMsg = document.getElementById('welcome-message');
                    
                    const userInfoMobile = document.getElementById('user-info-mobile');
                    const authButtonsMobile = document.getElementById('auth-buttons-mobile');
                    const welcomeMsgMobile = document.getElementById('welcome-message-mobile');
                    
                    document.getElementById('admin-nav-link').style.display = isAdmin ? 'block' : 'none';
                    document.getElementById('admin-mobile-nav-link').style.display = isAdmin ? 'block' : 'none';
                    document.getElementById('admin-footer-link').style.display = isAdmin ? 'block' : 'none';
                    
                    if(isAdmin) {
                        App.renderAdminPanelConvoys(App.state.liveConvoys.length > 0 ? App.state.liveConvoys : App.fallbackData.convoys);
                    } else {
                        const adminList = document.getElementById('admin-convoy-list');
                        if(adminList) adminList.innerHTML = ''; 
                    }

                    if (user) {
                        // Giriş yapılmış
                        // Profil 'username'i varsa onu, yoksa e-postayı göster
                        const displayName = user.username || (user.email ? user.email.split('@')[0] : 'User');
                        welcomeMsg.textContent = `Welcome, ${displayName}`;
                        userInfo.style.display = 'flex';
                        authButtons.style.display = 'none';
                        
                        welcomeMsgMobile.textContent = `Welcome, ${displayName}`;
                        userInfoMobile.style.display = 'block';
                        authButtonsMobile.style.display = 'none';
                        
                    } else {
                        // Giriş yapılmamış
                        userInfo.style.display = 'none';
                        authButtons.style.display = 'block';
                        
                        userInfoMobile.style.display = 'none';
                        authButtonsMobile.style.display = 'block';
                    }
                },
                
                showTab(tabName) {
                    const errorEl = document.getElementById('auth-error');
                    errorEl.style.display = 'none'; 
                    
                    if (tabName === 'login') {
                        document.getElementById('login-form').style.display = 'block';
                        document.getElementById('signup-form').style.display = 'none';
                        document.getElementById('tab-login').classList.add('active');
                        document.getElementById('tab-signup').classList.remove('active');
                    } else {
                        document.getElementById('login-form').style.display = 'none';
                        document.getElementById('signup-form').style.display = 'block';
                        document.getElementById('tab-login').classList.remove('active');
                        document.getElementById('tab-signup').classList.add('active');
                    }
                },
                
                togglePasswordVisibility(fieldId, icon) {
                    const input = document.getElementById(fieldId);
                    if (input.type === "password") {
                        input.type = "text";
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        input.type = "password";
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                }
            },
            
            language: {
                translations: {
                    navHome: "Homepage",
                    navNews: "News",
                    navConvoys: "Convoys",
                    navTeam: "Our Team",
                    navGallery: "Gallery",
                    navLegal: "Legal",
                    navAdmin: "Admin",
                    applyNow: "Login / Sign Up",
                    heroTitle: "Their dream is our standard.",
                    heroSubtitle: "Join one of TruckersMP's most professional and friendly communities to take your virtual logistics experience to the next level.",
                    joinUs: "Join Now",
                    seeConvoys: "See Convoys",
                    aboutTitle: "Who Are We?",
                    aboutText: "Iиfıиıтч Gяσuρ® was founded on 20.09.2025 and is managed professionally today. It is a Euro Truck Simulator 2 focused community, maintaining its activities regularly and steadily.",
                    statsDrivers: "Total Drivers",
                    statsConvoys: "Upcoming Convoys",
                    statsDiscord: "Discord Members",
                    statsFounded: "Founded",
                    latestNewsTitle: "Latest News",
                    latestNewsSubtitle: "The latest announcements from our VTC.",
                    readMore: "Read More",
                    publishedBy: "Published by:",
                    ctaTitle: "Ready to Join Us?",
                    ctaSubtitle: "Visit our application page to become a part of our team and share this excitement.",
                    ctaButton: "Go to Application Page",
                    newsTitle: "VTC News",
                    newsSubtitle: "The latest announcements and developments from our team.",
                    loadingNews: "Loading news...",
                    newsFallback: "Live news data could not be loaded temporarily.",
                    noNews: "No news published yet.",
                    convoysTitle: "Upcoming Convoys",
                    convoysSubtitle: "Mark your calendars for our upcoming adventures.",
                    loadingConvoys: "Loading convoys...",
                    convoyFallback: "Live convoy data could not be loaded temporarily.",
                    noConvoys: "No upcoming convoys found.",
                    ourConvoys: "Our Convoys",
                    attendingConvoys: "Attending Convoys",
                    hostedBy: "Hosted by:",
                    departure: "Departure:",
                    arrival: "Arrival:",
                    server: "Server:",
                    selectSlot: "Book Slot", 
                    teamTitle: "Our Team",
                    teamSubtitle: "The amazing people who make up Iиfıиıтч Gяσuρ®.",
                    loadingTeam: "Loading team list...",
                    teamFallback: "Live team list could not be loaded temporarily.",
                    noMembers: "No team members found.",
                    viewProfile: "View Profile",
                    galleryTitle: "Our Gallery",
                    gallerySubtitle: "Some of our best moments on the road.",
                    followInstagram: "Follow for More",
                    applyTitle: "Ready to Join Us?",
                    applySubtitle: "Login or Sign Up to become part of our community and manage your convoy slots.",
                    legalTitle: "Legal Information",
                    legalSubtitle: "Our Terms of Use and Privacy Policy.",
                    termsTitle: "Terms of Use",
                    termsText: "By using the Iиfıиıтч Gяσuρ® VTC (\"we\", \"our\") website, Discord server, and other services, you agree to these terms of use. While using our services, you are obligated to comply with TruckersMP rules and our own VTC rules. Disrespect towards the community, cheating, or harmful behavior will result in removal from the VTC. We reserve the right to terminate your membership at any time at our discretion.",
                    privacyTitle: "Privacy Policy",
                    privacyText: "We value your privacy. Personal data provided during application (Discord ID, TruckersMP profile, age, etc.) is used solely for managing VTC membership, facilitating communication, and organizing community events. This information is strictly not shared with or sold to third parties. Our website may use cookies necessary for basic functionality. You have the right to request the deletion of your personal data by contacting the management.",
                    botPrivacyTitle: "Discord Bot Privacy Policy",
                    botPrivacyText: "Our custom bot used on our Discord server may collect publicly available user information (such as User ID, username) and command usage data to provide its features and facilitate server moderation. This data is stored securely and used solely for the internal operation of the VTC. This data is never shared with third parties outside the VTC.",
                    footerSlogan: "\"Their dream is our standard.\"",
                    footerSitemap: "Sitemap",
                    footerSocial: "Social Media",
                    footerRights: "All rights reserved.",
                    slotSelectInfo: "This feature is being upgraded. Please login as a VTC Leader to book a slot.",
                    adminSlotInfo: "(Admin: You can edit occupied slots)",
                    bookSlot: "Slot {slotId} - Book",
                    slotTakenBy: "Taken by: {user}",
                    adminEditSlot: "Edit: {user}",
                    slotAlreadyTaken: "This slot is already taken.",
                    adminSlotActionPrompt: "Current user: {current}. Enter new username or leave empty to clear slot:",
                    slotUsernamePrompt: "Enter your username for Slot {slotId}:",
                    adminTitle: "Admin Panel",
                    adminSubtitle: "Convoy Slot Management",
                    loadingAdminConvoys: "Loading convoys to manage...",
                    noAdminConvoys: "No convoys found to manage.",
                    manageSlots: "Manage Slots",
                    slotOccupancy: "Slot Occupancy"
                },

                apply() {
                    document.querySelectorAll('[data-translate]').forEach(el => {
                        const key = el.dataset.translate;
                        if (this.translations[key]) {
                             const icon = el.querySelector('i');
                             if(icon && el.childNodes.length > 1) {
                                 const currentText = Array.from(el.childNodes).find(node => node.nodeType === Node.TEXT_NODE)?.nodeValue.trim();
                                 const newText = this.translations[key];
                                 if (currentText !== newText) {
                                     el.innerHTML = `${newText} ${icon.outerHTML}`;
                                 }
                             } else {
                                 if (el.textContent !== this.translations[key]) {
                                     el.textContent = this.translations[key];
                                 }
                             }
                        }
                    });
                     
                     const slotGrid = document.getElementById('slot-grid');
                     if(slotGrid){
                         //... (eski slot render kodu şimdilik kalabilir, bir zararı yok)
                     }
                },
                 translate(key, params = {}) {
                     let text = this.translations[key] ? this.translations[key] : key;
                     for (const param in params) {
                         text = text.replace(`{${param}}`, params[param]);
                     }
                     return text;
                 }
            },
            
            setupScrollAnimations(forceAnimateStats = false) {
                 const sections = document.querySelectorAll('.page-content > div:not(.bg-bg-secondary), .bg-bg-secondary > div');
                 const animateStats = (counter) => {
                     const target = +counter.dataset.target;
                     if ((!counter.hasAttribute('data-animated') || forceAnimateStats) && !isNaN(target)) {
                         counter.setAttribute('data-animated', 'true');
                         let count = 0;
                         const duration = 1000;
                         const startTime = performance.now();

                         const step = (currentTime) => {
                             const elapsedTime = currentTime - startTime;
                             const progress = Math.min(1, elapsedTime / duration);
                             count = Math.ceil(progress * target);
                             counter.innerText = count.toLocaleString('en-US'); 
                             if (progress < 1) {
                                 requestAnimationFrame(step);
                             } else {
                                 counter.innerText = target.toLocaleString('en-US');
                             }
                         };
                          requestAnimationFrame(step);
                     } else if (isNaN(target)){
                          counter.innerText = counter.dataset.target;
                     }
                 };

                 if (App.sectionObserver) App.sectionObserver.disconnect();

                App.sectionObserver = new IntersectionObserver((entries, observer) => {
                     entries.forEach(entry => {
                         if (entry.isIntersecting) {
                             entry.target.classList.add('is-visible');
                             const stats = entry.target.querySelectorAll('[data-target]');
                             if(stats.length > 0) {
                                  stats.forEach(animateStats);
                             }
                         }
                     });
                }, { threshold: 0.1 });

                document.querySelectorAll('.bg-bg-secondary, .container').forEach(section => {
                     if(!section.classList.contains('fade-in-section')){
                         section.classList.add('fade-in-section');
                     }
                     App.sectionObserver.observe(section);
                });

                 if (forceAnimateStats) {
                     document.querySelectorAll('[data-target]').forEach(counter => {
                         const rect = counter.getBoundingClientRect();
                         if (rect.top >= 0 && rect.bottom <= window.innerHeight) {
                             counter.removeAttribute('data-animated');
                             animateStats(counter);
                         }
                     });
                 }
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
